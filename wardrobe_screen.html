
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Монстрик в шкафу</title>
  <meta name="viewport"
        content="width=375, initial-scale=1, maximum-scale=1, viewport-fit=cover" />

  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Helvetica Neue", Arial, sans-serif;
      background: #f5f5f7;
      color: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    /* "Телефон" 375×812 */
    .phone {
      position: relative;
      width: 375px;
      height: 812px;
      background: #f5f5f7;
      overflow: hidden;
    }

    /* Верхняя панель */
    .top-bar {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 144px; /* серый верх, как на макете */
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 16px 20px 0;
    }

    .back-button {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #111;
      font-size: 16px;
      cursor: pointer;
      background: none;
      border: none;
    }

    .back-arrow {
      font-size: 18px;
      transform: translateY(-1px);
    }

    .icon-button {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 1.5px solid #111;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.8);
      cursor: pointer;
    }

    .hanger-icon {
      width: 16px;
      height: 10px;
      border-bottom: 1.5px solid #111;
      border-radius: 0 0 50% 50%;
      position: relative;
    }

    .hanger-icon::before {
      content: "";
      position: absolute;
      left: 50%;
      top: -4px;
      width: 6px;
      height: 6px;
      border: 1.5px solid #111;
      border-radius: 50%;
      transform: translateX(-50%);
      border-bottom-color: transparent;
      border-left-color: transparent;
    }

    /* Шкаф: 375×518, строго по центру */
    .wardrobe-wrapper {
      position: absolute;
      left: 0;
      top: 144px;
      width: 375px;
      height: 518px;
    }

    .wardrobe-image {
      width: 100%;
      height: 100%;
      display: block;
      border-radius: 0;
      object-fit: cover;
    }

    /* Три белые кнопки слева (привязаны к шкафу) */
    .side-button {
      position: absolute;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #ffffff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.18);
      border: none;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      cursor: pointer;
      z-index: 15;
    }

    /* координаты относительно ЛЕВОГО ВЕРХНЕГО УГЛА ШКАФА (top:144) */
    .side-button-1 { left: 36px; top: 35px; }  /* на уровне верхней одежды */
    .side-button-2 { left: 36px; top: 210px; }
    .side-button-3 { left: 36px; top: 380px; }  /* низ, как в макете */

    .side-button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
    }

    .side-button:active {
      transform: scale(0.95);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    /* Контейнер под 3D-монстра
       ВНИМАНИЕ: размеры и позиция по ТВОИМ цифрам
       ширина 187, высота 280
       отступ слева 96, сверху 304 от всего экрана 375×812
    */
    .monster-container {
      position: absolute;
      left: 100px;
      top: 310px;
      bottom: 100px;
      width: 310px;
      height: 450px;
      pointer-events: none;
      z-index: 20;
      overflow: visible;
    }

    .monster-container canvas {
      width: 60%;
      height: 70%;
      display: block;
    }

    /* Нижняя панель с монеткой */
    .bottom-panel {
      position: absolute;
      left: 0;
      bottom: 24px;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
    }

    .coin-button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 22px;
      border-radius: 999px;
      background: #f7d9b8;
      font-size: 16px;
      box-shadow: 0 4px 9px rgba(0, 0, 0, 0.15);
      cursor: pointer;
    }

    .coin-icon {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1.5px solid #111;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    .round-button {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #f7d9b8;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 4px 9px rgba(0, 0, 0, 0.15);
      cursor: pointer;
    }

    /* Модалка “откроется на 5 уровне” */
    .modal {
      position: absolute;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }

    .modal.visible {
      display: flex;
    }

    .modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.25);
    }

    .modal-window {
      position: relative;
      max-width: 300px;
      width: 80%;
      background: #ffffff;
      border-radius: 18px;
      padding: 20px 20px 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      text-align: center;
      z-index: 1;
    }

    .modal-text {
      margin: 0 0 16px;
      font-size: 14px;
      line-height: 1.4;
    }

    .modal-close-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 18px;
      border-radius: 999px;
      background: #ff4b4b;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
    }

    .modal-close-button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25) inset;
    }
    
  </style>
</head>
<body>
  <div class="phone">
    <!-- Верх -->
    <header class="top-bar">
      <button class="back-button" id="backButton">
        <span class="back-arrow">←</span>
        <span>Назад</span>
      </button>

      <button class="icon-button" id="hangerButton" aria-label="Гардероб">
        <span class="hanger-icon"></span>
      </button>
    </header>

    <!-- Шкаф -->
    <div class="wardrobe-wrapper">
      <img src="wardrobe_full.png" alt="Шкаф" class="wardrobe-image" />

      <!-- три круглых кнопки слева -->
      <button class="side-button side-button-1" id="sideButton1"></button>
      <button class="side-button side-button-2" id="sideButton2"></button>
      <button class="side-button side-button-3" id="sideButton3"></button>
    </div>

    <!-- Контейнер монстра -->
    <div class="monster-container" id="monsterContainer"></div>

 <!-- Нижняя плашка -->
    <div class="bottom-panel">
      <button class="coin-button" id="coinButton">
        <span class="coin-text">30</span>
        <span class="coin-icon">◎</span>
      </button>
      <button class="round-button" id="plusButton">+</button>
    </div>
    
          
    <!-- Модалка -->
    <div class="modal" id="lockedModal">
      <div class="modal-backdrop"></div>
      <div class="modal-window">
        <p class="modal-text">
          откроется на 5 уровне! ждем тебя, совсем скоро!
        </p>
        <button class="modal-close-button" id="modalCloseButton">понятно</button>
      </div>
    </div>
  </div>

  <!-- JS: three.js + логика -->
  <script type="module">
    /***********************
     * Импорты three.js
     ***********************/
import * as THREE from 'https://unpkg.com/three@latest/build/three.module.js';
import { OrbitControls } from 'https://unpkg.com/three@latest/examples/jsm/controls/OrbitControls.js';
import { GLTFLoader } from 'https://unpkg.com/three@latest/examples/jsm/loaders/GLTFLoader.js';
    /***********************
     * DOM-элементы
     ***********************/
    const backButton = document.getElementById("backButton");
    const hangerButton = document.getElementById("hangerButton");
    const sideButton1 = document.getElementById("sideButton1");
    const sideButton2 = document.getElementById("sideButton2");
    const sideButton3 = document.getElementById("sideButton3");
    const coinButton = document.getElementById("coinButton");
    const plusButton = document.getElementById("plusButton");
    const monsterContainer = document.getElementById("monsterContainer");

    const modal = document.getElementById("lockedModal");
    const modalBackdrop = modal.querySelector(".modal-backdrop");
    const modalCloseButton = document.getElementById("modalCloseButton");

    /***********************
     * Обработчики интерфейса
     ***********************/
    backButton.addEventListener("click", () => {
      window.location.href =
        "https://mmarmar4028-gif.github.io/kids-site/game_screen.html";
    });

    hangerButton.addEventListener("click", () => {
      modal.classList.add("visible");
    });

    sideButton2.addEventListener("click", () => {
      console.log("Вторая боковая кнопка нажата");
      modal.classList.add("visible");
    });

    sideButton1.addEventListener("click", () => {
      console.log("Первая боковая кнопка нажата");
    });

    sideButton3.addEventListener("click", () => {
      console.log("Третья боковая кнопка нажата");
    });

    const closeModal = () => modal.classList.remove("visible");
    modalCloseButton.addEventListener("click", closeModal);
    modalBackdrop.addEventListener("click", closeModal);

    coinButton.addEventListener("click", () => {
      console.log("Кнопка монет нажата");
    });

    plusButton.addEventListener("click", () => {
      console.log("Кнопка '+' нажата");
    });

    /***********************
     * THREE.JS: сцена, камера, рендер
     ***********************/
    const scene = new THREE.Scene();

    const camera = new THREE.PerspectiveCamera(35, 1, 0.1, 100);
    camera.position.set(0, 0.4, 1.6);

    const renderer = new THREE.WebGLRenderer({
      antialias: true,
      alpha: true
    });
    renderer.setPixelRatio(window.devicePixelRatio || 1);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    monsterContainer.appendChild(renderer.domElement);

    function resizeRenderer() {
      const width = monsterContainer.clientWidth || 187;
      const height = monsterContainer.clientHeight || 280;
      renderer.setSize(width, height, false);
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
    }

    resizeRenderer();
    window.addEventListener("resize", resizeRenderer);

    const hemiLight = new THREE.HemisphereLight(0xffffff, 0xffcccc, 1.2);
    hemiLight.position.set(0, 1, 0);
    scene.add(hemiLight);

    const dirLight = new THREE.DirectionalLight(0xffffff, 0.9);
    dirLight.position.set(1, 1.2, 1.5);
    scene.add(dirLight);

    /***********************
     * Загрузка DRACO + GLB-модели
     ***********************/
    const dracoLoader = new DRACOLoader();
    dracoLoader.setDecoderPath(
      "https://www.gstatic.com/draco/versioned/decoders/1.5.6/"
    );
    dracoLoader.setDecoderConfig({ type: "js" });
    dracoLoader.preload();

    const gltfLoader = new GLTFLoader();
    gltfLoader.setDRACOLoader(dracoLoader);

    let monster = null;

    gltfLoader.load(
      "monster.glb",
      (gltf) => {
        monster = gltf.scene;

        // Нормализуем модель: центр в (0,0,0), масштаб по высоте
       // 1) bounds модели
const box = new THREE.Box3().setFromObject(monster);
const size = box.getSize(new THREE.Vector3());
const center = box.getCenter(new THREE.Vector3());

// 2) центрируем модель
monster.position.sub(center);

// 3) FIT-камера с учетом aspect (чтобы не резало ни по ширине, ни по высоте)
const fitOffset = 1.8; // увеличь до 2.0 если всё ещё режет
const aspect = camera.aspect;

const vFOV = THREE.MathUtils.degToRad(camera.fov);             // вертикальный
const hFOV = 2 * Math.atan(Math.tan(vFOV / 2) * aspect);       // горизонтальный

const distV = (size.y / 2) / Math.tan(vFOV / 2);
const distH = (size.x / 2) / Math.tan(hFOV / 2);
const distance = Math.max(distV, distH) * fitOffset;

camera.position.set(0, 0.2, distance);
camera.lookAt(0, 0, 0);
camera.near = distance / 100;
camera.far  = distance * 100;
camera.updateProjectionMatrix();

        
        monster.traverse((child) => {
          if (child.isMesh) {
            child.castShadow = false;
            child.receiveShadow = false;
          }
        });

        scene.add(monster);
        console.log("Модель монстрика успешно загружена");
      },
      undefined,
      (error) => {
        console.error("Ошибка при загрузке модели монстрика:", error);
      }
    );

    /***********************
     * Анимация — монстрик крутится по Y
     ***********************/
    function animate() {
      requestAnimationFrame(animate);

      if (monster) {
        monster.rotation.y += 0.01;
      }

      renderer.render(scene, camera);
    }

    animate();

  </script>

  <script>
    // LocalStorage — общее для всех экранов
let userData = JSON.parse(localStorage.getItem('plushikUser'));
if (!userData) {
  userData = { name: "Александра", balance: 6000, alfiki: 30 };
  localStorage.setItem('plushikUser', JSON.stringify(userData));
}

// Обновляем число альфиков на этом экране при загрузке
const alfikiDisplayNew = document.getElementById('alfikiCount');
if (alfikiDisplayNew) alfikiDisplayNew.textContent = userData.alfiki;

// Функция покупки (та же, что и на других экранах)
function buyAlfiki(count, price) {
  let data = JSON.parse(localStorage.getItem('plushikUser')) || { balance: 6000, alfiki: 30 };
  if (data.balance >= price) {
    data.balance -= price;
    data.alfiki += count;
    localStorage.setItem('plushikUser', JSON.stringify(data));
    
    // Обновляем на ЭТОМ экране
    if (alfikiDisplayNew) alfikiDisplayNew.textContent = data.alfiki;
    
    alert(`Куплено ${count} альфиков! Осталось: ${data.balance} ₽`);
  } else {
    alert('Недостаточно денег!');
  }
  closeOverlay('buy-alfiki-popup');
}

  // Закрытие любого поп-апа по клику на тёмный фон
document.querySelectorAll('.overlay').forEach(overlay => {
  overlay.addEventListener('click', function(e) {
    if (e.target === overlay) {
      overlay.style.display = 'none';
    }
  });
});
</script>
  
</body>
</html>
